<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Order Form</title>
		<link rel="icon" type="image/svg+xml" href="favicon.svg" />
		<link rel="apple-touch-icon" href="favicon.svg" />
		<link rel="stylesheet" href="style.css" />
		<style>
			/* Using existing styles from style.css */
			body {
				padding: 2rem 1rem;
				display: flex;
				justify-content: center;
				min-height: 100vh;
				align-items: flex-start;
			}

			.form-container {
				max-width: 600px;
				width: 100%;
				margin: 1rem auto;
				padding: 1.5rem;
				background: var(--bg-dark);
				border: 1px solid var(--border-color);
				border-radius: var(--radius);
				box-shadow: 0 0 30px rgba(201, 9, 23, 0.2);
			}

			.form-section {
				margin-bottom: 1.25rem;
			}

			.form-section h3 {
				color: var(--accent-red);
				margin-bottom: 0.75rem;
				font-size: 1.1rem;
			}

			.form-group {
				margin-bottom: 1rem;
			}

			.form-group label {
				display: block;
				margin-bottom: 0.35rem;
				color: var(--text-muted);
				font-size: 0.9rem;
			}

			.form-group input,
			.form-group select,
			.form-group textarea {
				width: 100%;
				padding: 0.5rem 0.75rem;
				background: var(--bg-dark);
				border: 1px solid var(--border-color);
				border-radius: 6px;
				color: var(--text-light);
				font-size: 0.9rem;
			}

			.form-group textarea {
				min-height: 80px;
				resize: vertical;
			}

			.radio-group {
				margin-bottom: 1rem;
			}

			.radio-group label {
				display: inline-flex;
				align-items: center;
				margin-right: 1.5rem;
				color: var(--text-light);
				cursor: pointer;
				font-size: 0.9rem;
			}

			.radio-group input[type='radio'] {
				margin-right: 0.35rem;
				accent-color: var(--accent-red);
			}
			
			h1 {
				font-size: 1.5rem;
				margin-bottom: 1.25rem;
			}
			
			.btn {
				padding: 0.5rem 1.25rem;
				font-size: 0.9rem;
			}
		</style>
	</head>
	<body>
		<div class="form-container">
			<h1>Order Information</h1>

			<div class="form-section">
				<h3>Customer Type</h3>
				<div class="radio-group">
					<label>
						<input type="radio" name="customerType" value="new" checked />
						New Customer
					</label>
					<label>
						<input type="radio" name="customerType" value="existing" />
						Existing Customer
					</label>
				</div>
			</div>

			<div id="newCustomerForm" class="form-section">
				<h3>New Customer Information</h3>
				<div class="form-group">
					<label for="firstName">First Name *</label>
					<input type="text" id="firstName" required />
				</div>
				<div class="form-group">
					<label for="lastName">Last Name *</label>
					<input type="text" id="lastName" required />
				</div>
				<div class="form-group">
					<label for="email">Email *</label>
					<input type="email" id="email" required />
				</div>
				<div class="form-group">
					<label for="companyName">Company Name (Optional)</label>
					<input type="text" id="companyName" />
				</div>
				<div class="form-group">
					<label for="billingAddress">Billing Address *</label>
					<textarea id="billingAddress" rows="3" required></textarea>
				</div>
				<div class="form-group">
					<label for="shippingAddress">Shipping Address *</label>
					<textarea id="shippingAddress" rows="3" required></textarea>
				</div>
			</div>

			<div id="existingCustomerForm" class="form-section hidden">
				<h3>Existing Customer Information</h3>
				<div class="form-group">
					<label for="existingEmail">Email *</label>
					<input type="email" id="existingEmail" required />
				</div>
			</div>

			<div class="form-section">
				<button class="btn" id="submitBtn">Continue to Checkout</button>
			</div>

			<div id="errorContainer" class="hidden">
				<p id="errorMessage" style="color: red"></p>
			</div>
		</div>

		<script>
			// Get URL parameters
			const params = new URLSearchParams(window.location.search);
			const planID = params.get('planID');
			const cf_dealer_id = params.get('cf_dealer_id');
			const cf_agent_id = params.get('cf_agent_id');
			const source = params.get('source');

			if (!planID || !cf_dealer_id || !cf_agent_id) {
				document.getElementById('errorContainer').classList.remove('hidden');
				document.getElementById('errorMessage').textContent =
					'Missing required parameters';
			}

			// Toggle form sections based on customer type
			document
				.querySelectorAll('input[name="customerType"]')
				.forEach((radio) => {
					radio.addEventListener('change', () => {
						const isExisting = radio.value === 'existing';
						document
							.getElementById('newCustomerForm')
							.classList.toggle('hidden', isExisting);
						document
							.getElementById('existingCustomerForm')
							.classList.toggle('hidden', !isExisting);
					});
				});

			document
				.getElementById('submitBtn')
				.addEventListener('click', async () => {
					const customerType = document.querySelector(
						'input[name="customerType"]:checked'
					).value;
					let customerData = {};

					if (customerType === 'new') {
						customerData = {
							'First Name': document.getElementById('firstName').value,
							'Last Name': document.getElementById('lastName').value,
							Email: document.getElementById('email').value,
							'Company Name': document.getElementById('companyName').value,
							'Billing Address':
								document.getElementById('billingAddress').value,
							'Shipping Address':
								document.getElementById('shippingAddress').value,
						};
					} else {
						customerData = {
							Email: document.getElementById('existingEmail').value,
						};
					}

					// Validate required fields
					const requiredFields = ['Email'];
					const missingFields = requiredFields.filter(
						(field) => !customerData[field]
					);

					if (missingFields.length > 0) {
						document
							.getElementById('errorContainer')
							.classList.remove('hidden');
						document.getElementById(
							'errorMessage'
						).textContent = `Please fill in all required fields: ${missingFields.join(
							', '
						)}`;
						return;
					}

					// Prepare URL parameters
					const urlParams = new URLSearchParams({
						planID,
						cf_dealer_id,
						cf_agent_id,
						source,
						customerInfo: JSON.stringify(customerData),
					});

					// Redirect to getUrls with customer information
					const redirectUrl = `/.netlify/functions/getUrls?${urlParams.toString()}`;
					window.location.href = redirectUrl;
				});
		</script>
	</body>
</html>
